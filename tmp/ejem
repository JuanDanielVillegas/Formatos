<%@ Page Language="VB"%>
<%@ Import Namespace="System.Data"%>
<%@ Import Namespace="System.Data.OleDb"%>
<%@ Import Namespace="System.Data.SqlClient" %>
<script runat="server">

	Sub Enviar(ByVal sender as Object, ByVal e as System.EventArgs)
		Dim str_cadena as String
		
		If request.Form("s_emp")<>"" Then
			str_cadena = "per_modificacion_p_nuevo.aspx?emp=" &  request.Form("s_emp")		
			response.Redirect(str_cadena)
		End If
		
	End Sub
	
	Sub Enviar_xls(ByVal sender as Object, ByVal e as System.EventArgs)
		Dim str_cadena as String
		
		str_cadena = "per_consulta_xls.aspx?emp=" & request.Form("s_emp")
		
		response.Redirect(str_cadena)
	End sub
	

	Sub Page_load (obj as Object, e as EventArgs)
		'Declaracion de Variables y cadenas de coneccion
        Dim Conn As New SqlConnection("server=10.18.101.12;Initial Catalog=Fiscalizacion;User=" & Request.Cookies("ss_intrafiscal")("ss_usuario") & ";Password=" & Request.Cookies("ss_intrafiscal")("ss_clave"))
        Dim ConnODB As New OleDbConnection("Provider=sqloledb;Data Source=10.18.101.12;Initial Catalog=Fiscalizacion;User Id=" & Request.Cookies("ss_intrafiscal")("ss_usuario") & ";Password=" & Request.Cookies("ss_intrafiscal")("ss_clave"))
		Dim Nulo as System.DBNull
		
		'Creamos los objetos para llenar los procedimientos Almacenados
		Dim objComando_Secre as SqlCommand
		objComando_Secre = New SqlCommand("pa_lst_Secre_Net", Conn)
		
		Dim objComando_Cd as SqlCommand
		objComando_Cd = New SqlCommand("pa_lst_CD_Net", Conn)
		
		Dim objComando_Dire = New OleDbCommand("pa_lst_DireXsecre_Net", ConnODB)
		objComando_Dire.CommandType = CommandType.StoredProcedure
		
		Dim objComando_Depto = New OleDbCommand("pa_lst_DeptoxDire_Net", ConnODB)
		objComando_Depto.CommandType = CommandType.StoredProcedure
		
		Dim objComando_Puesto = New OleDbCommand("pa_lst_PuestoxDire_Net", ConnODB)
		objComando_Puesto.CommandType = CommandType.StoredProcedure
		
		Dim objComando_Emp = New OleDbCommand("pa_lst_emXdcp_net", ConnODB)
		objComando_Emp.CommandType = CommandType.StoredProcedure
		
		If Not Page.IsPostBack Then
			Dim objLeerSecre as SqlDataReader
			objComando_Secre.Connection.Open()
			objLeerSecre = objComando_Secre.ExecuteReader 
						
			s_secre.DataSource = objLeerSecre
			s_secre.DataTextField = "str_descri"
			s_secre.DataValueField = "c_secretaria"
			s_secre.DataBind()

			objComando_Secre.Connection.Close()
			
			Dim objLeerCd as SqlDataReader
			objComando_Cd.Connection.Open()
			objLeerCd = objComando_Cd.ExecuteReader
			
			s_cd.DataSource = objLeerCd
			s_cd.DataTextField = "str_ciudad"
			s_cd.DataValueField = "c_ciudad"
			s_cd.DataBind()
			
			objComando_Cd.Connection.Close()
		Else
			Dim objParametro_D as OleDbParameter			
			objParametro_D = objComando_Dire.Parameters.add("@int_secre", OleDbType.integer)
			objParametro_D.Direction = ParameterDirection.Input
			
			If request.Form("s_secre") <> "" Then
				objParametro_D.Value = Cint(request.Form("s_secre"))
			Else
				objParametro_D.Value = -1
			End If
			
			Dim objLeerDire as OleDbDataReader
			objComando_Dire.Connection.Open()

			objLeerDire = objComando_Dire.ExecuteReader

			If request.Form("s_dire") = "" Then
				s_dire.DataSource = objLeerDire
				s_dire.DataTextField = "str_direccion"
				s_dire.DataValueField = "c_direccion"
				s_dire.DataBind()
			End If
			
			objComando_Dire.Connection.Close()
			
			Dim objParametro_Dpto as OleDbParameter			
			objParametro_Dpto = objComando_Depto.Parameters.add("@int_dire", OleDbType.integer)
			objParametro_Dpto.Direction = ParameterDirection.Input
			
			If request.Form("s_dire") <> "" Then
				objParametro_Dpto.Value = Cint(request.Form("s_dire"))
			Else
				objParametro_Dpto.Value = -1
			End If
			
			Dim objLeerdepto as OleDbDataREader
			objComando_Depto.Connection.open()
			
			objLeerDepto =  objComando_Depto.ExecuteReader
			
			If request.Form("s_depto") = "" Then
				s_depto.DataSource = objLeerDepto
				s_depto.DataTextField = "str_depto"
				s_depto.DataValueField = "c_depto"
				s_depto.DataBind()
			End If
			
			objComando_Depto.Connection.Close()
		
			Dim objParametro_Puesto as OleDbParameter
			objParametro_puesto = objComando_Puesto.Parameters.Add("@int_dire", OleDbType.integer)
			objParametro_Puesto.Direction = ParameterDirection.Input
			
			If request.Form("s_dire") <> "" Then
				objParametro_puesto.Value = Cint(request.Form("s_dire"))
			Else
				objParametro_puesto.Value = -1
			End If
		
			Dim objLeerPuesto as OleDbDataReader
			objComando_puesto.Connection.Open()
			objLeerPuesto = objComando_puesto.ExecuteReader
		
			If request.Form("s_puesto") = "" Then
				s_puesto.DataSource = objLeerPuesto
				s_puesto.DataTextField = "str_puesto"
				s_puesto.DataValueField = "c_puesto"
				s_puesto.DataBind()
			End If
			
			objComando_puesto.Connection.Close()
			
			Dim objParametro_Emp_Dir as OleDbparameter
			objParametro_Emp_Dir = objComando_Emp.Parameters.Add("@int_dire", OleDbType.Integer)
			objParametro_Emp_dir.Direction = ParameterDirection.Input
			
			If request.Form("s_dire") <> "" Then
				objParametro_Emp_Dir.Value = Cint(request.Form("s_dire"))
			Else
				objParametro_Emp_Dir.Value = Nulo.value
			End If
		
			Dim objParametro_Emp_Dpt as OleDbparameter
			objParametro_Emp_Dpt = objComando_Emp.Parameters.Add("@int_depto", OleDbType.Integer)
			objParametro_Emp_Dpt.Direction = ParameterDirection.Input
			
			If request.Form("s_depto") <> "" Then
				objParametro_Emp_Dpt.Value = Cint(request.Form("s_depto"))
			Else
				objParametro_Emp_Dpt.Value = Nulo.value
			End If
			
			Dim objParametro_Emp_Cd as OleDbparameter
			objParametro_Emp_Cd = objComando_Emp.Parameters.Add("@int_depto", OleDbType.Integer)
			objParametro_Emp_Cd.Direction = ParameterDirection.Input
			
			If request.Form("s_cd") <> "" Then
				objParametro_Emp_Cd.Value = Cint(request.Form("s_cd"))
			Else
				objParametro_Emp_Cd.Value = Nulo.value
			End If
		
			Dim objParametro_Emp_Pu as OleDbparameter
			objParametro_Emp_Pu = objComando_Emp.Parameters.Add("@int_puesto", OleDbType.Integer)
			objParametro_Emp_Pu.Direction = ParameterDirection.Input
			
			If request.Form("s_puesto") <> "" Then
				objParametro_Emp_Pu.Value = Cint(request.Form("s_puesto"))
			Else
				objParametro_Emp_Pu.Value = Nulo.value
			End If
			
			Dim objLeerEmp as OleDbDataREader
			objComando_Emp.Connection.open()
			
			objLeerEmp =  objComando_Emp.ExecuteReader
			
			If request.Form("s_dire") <> "" Then
				s_emp.DataSource = objLeerEmp
				s_emp.DataTextField = "empleado"
				s_emp.DataValueField = "c_empleado"
				s_emp.DataBind()
			End If
		
		
		End If

	End Sub
</script>
<html>
<head>
<title>Consulta de Personal</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../estilos/estilos.css" rel="stylesheet" type="text/css">
</head>

<body>
<form action="" method="post" name="form1" runat="server">
  <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr> 
  <td width="1%">&nbsp;</td>
      <td width="99%"><table width="100%" cellpadding="0" cellspacing="0">
          <tr> 
            <td><div align="center" class="tit"><strong><font color="#FFFFFF" size="2" face="Verdana, Rage Italic"><em>Control 
                de Personal</em></font></strong></div></td>
          </tr>
      </table></td>
      <td width="0%">&nbsp;</td>
    </tr>
    <tr> 
      <td>&nbsp;</td>
      <td><table width="100%" cellpadding="0" cellspacing="0">
          <tr> 
            <td><div align="center" class="tit2"><font size="2" face="Verdana, Rage Italic"><strong><em>Modificaci&oacute;n 
                de Personal</em></strong></font></div></td>
          </tr>
        </table></td>
      <td>&nbsp;</td>
    </tr>
    <tr> 
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr> 
      <td>&nbsp;</td>
      <td><table width="100%" border="0" cellspacing="0" cellpadding="7">
          <tr> 
            <td width="1%">&nbsp;</td>
            <td width="13%"><strong><font size="-2" face="Verdana, Arial, Helvetica, sans-serif">Ciudad:</font></strong></td>
            <td width="36%"><asp:DropDownList ID="s_cd" AutoPostBack="true" runat="server"></asp:DropDownList></td>
            <td width="30%">&nbsp;</td>
            <td width="20%">&nbsp;</td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td><strong><font size="-2" face="Verdana, Arial, Helvetica, sans-serif">Secretaria</font></strong></td>
            <td><asp:DropDownList ID="s_secre" runat="server" AutoPostBack="true"></asp:DropDownList></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td><strong><font size="-2" face="Verdana, Arial, Helvetica, sans-serif">Direcci&oacute;n</font></strong></td>
            <td><asp:DropDownList ID="s_dire" runat="server" AutoPostBack="true"></asp:DropDownList></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr> 
            <td>&nbsp;</td>
            <td><strong><font size="-2" face="Verdana, Arial, Helvetica, sans-serif">Departamento</font></strong></td>
            <td><asp:DropDownList ID="s_depto" runat="server" AutoPostBack="true"></asp:DropDownList></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr> 
            <td>&nbsp;</td>
            <td><strong><font size="-2" face="Verdana, Arial, Helvetica, sans-serif">Puesto</font></strong></td>
            <td><asp:DropDownList ID="s_puesto" runat="server" AutoPostBack="true"></asp:DropDownList></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr> 
            <td>&nbsp;</td>
            <td><strong><font size="-2" face="Verdana, Arial, Helvetica, sans-serif">Nombre 
              </font></strong></td>
            <td><asp:DropDownList ID="s_emp" runat="server"></asp:DropDownList></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr> 
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr> 
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><font size="-1" face="Verdana, Arial, Helvetica, sans-serif">&nbsp;</font></td>
            <td><font size="-1" face="Verdana, Arial, Helvetica, sans-serif">&nbsp;</font></td>
          </tr>
        </table></td>
      <td>&nbsp;</td>
    </tr>
    <tr> 
      <td>&nbsp;</td>
      <td><font face="Verdana, Arial, Helvetica, sans-serif">&nbsp;</font></td>
      <td>&nbsp;</td>
    </tr>
    <tr> 
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr> 
      <td>&nbsp;</td>
      <td><table width="100%" border="1" cellspacing="0" cellpadding="0">
          <tr>
            <td width="50%"><asp:Button CssClass="bot" ID="bt_pantalla" runat="server" Text="Consultar" ToolTip="Consulta en Pantalla" OnClick="Enviar" /></td>
            <td width="50%"><div align="right">
              <asp:Button CssClass="bot" ID="bt_exel" runat="server" Text="Exportar" ToolTip="Exportar a Excel" OnClick="Enviar_xls" />
            </div></td>
          </tr>
        </table></td>
      <td>&nbsp;</td>
    </tr>
  </table>
</form>
</body>
</html>